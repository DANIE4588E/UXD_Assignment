<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Events</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/events.css" />
    <link rel="stylesheet" href="css/header.css" />
    <link rel="stylesheet" href="css/footer.css" />
</head>

<body style="margin:0; display:flex; flex-direction:column; height:100vh;">
    <div id="header-placeholder" style="flex:0 0 auto; height:70px;"></div>

    <main class="flex-grow-1">
        <div class="container py-5">
            <h2 class="mb-4">Upcoming Events</h2>
            <table class="table table-hover" id="events-table">
                <thead class="table-dark">
                    <tr>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Location</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- JS will inject rows here -->
                </tbody>
            </table>
        </div>
    </main>

    <div id="footer-placeholder" style="flex:0 0 auto;"></div>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- your app logic -->
    <script src="js/script.js"></script>
    <script>
        // ==== initialize Firebase ====
        const firebaseConfig = {
            apiKey: "AIzaSyDZVoZMsL5tRMKlR3Y2m68PCilZqOiLYdw",
            authDomain: "ux-assignment.firebaseapp.com",
            projectId: "ux-assignment",
            storageBucket: "ux-assignment.appspot.com",
            messagingSenderId: "695373901468",
            appId: "1:695373901468:web:942d3bfb6d8b17f2fe8759",
            measurementId: "G-Q13N4V4F26"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ==== fetch & render upcoming events ====
        window.addEventListener('DOMContentLoaded', async () => {
            const tbody = document.querySelector('#events-table tbody');
            const now = firebase.firestore.Timestamp.now();

            try {
                const snapshot = await db.collection('events')
                    .where('startTime', '>=', now)       // only future (or ongoing) events
                    .orderBy('startTime', 'asc')
                    .get();

                snapshot.forEach(doc => {
                    const { title, description, location, startTime, endTime } = doc.data();
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
        <td>${title}</td>
        <td>${description}</td>
        <td>${location}</td>
        <td>${startTime.toDate().toLocaleString()}</td>
        <td>${endTime.toDate().toLocaleString()}</td>
      `;
                    tbody.appendChild(tr);
                });

                if (snapshot.empty) {
                    tbody.innerHTML = `<tr><td colspan="5" class="text-center">No upcoming events.</td></tr>`;
                }
            } catch (err) {
                console.error('Error loading events:', err);
                tbody.innerHTML = `<tr><td colspan="5" class="text-danger text-center">Failed to load events.</td></tr>`;
            }
        });

    </script>
</body>

</html>