<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link href="css/styles.css" rel="stylesheet" />
    <link href="css/index.css" rel="stylesheet" />
    <link href="css/header.css" rel="stylesheet" />
    <link href="css/footer.css" rel="stylesheet" />

</head>

<body style="margin:0; display:flex; flex-direction:column; height:100vh;">
    <div id="header-placeholder" style="flex:0 0 auto; height:70px;"></div>

    <main>
        <div class="container mb-4 mb-md-0">
            <div class="row align-items-center">
                <div class="col-12 col-md-6 mb-md-0">
                    <img src="Resources/Badminton.png" alt="Badminton" class="img-fluid w-100 fade-in-element-r" />
                </div>
                <div class="col-12 col-md-6 ms-3 ms-md-0 mt-md-0 mt-4" style="color: #0A4B65;">
                    <h1 class="title fade-in-element-d" data-delay="0.1s"><i>SMASH LIMITS<br>SOAR TOGETHER</i></h1>
                    <div class="fade-in-element-u" data-delay="0.2s">
                        <p class="lead">
                            <i>Want to develop your strategic thinking and tactical awareness? Want to represent NYP in
                                competitions?</i>
                        </p>
                    </div>
                    <div class="fade-in-element-u" data-delay="0.3s">
                        <a href="signup.html" class="btn btn-primary">SIGN UP NOW</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Training Section -->
        <div class="container-fluid" style="background-color: #0A4B65;">
            <h2 class="title text-center text-white py-4 fade-in-element">TRAINING</h2>
            <div class="container">
                <div class="row row-cols-1 row-cols-md-3 my-0 mx-auto" style="max-width: 1200px;">
                    <div class="col pb-4 fade-in-element shadow-sm">
                        <img src="Resources/bmt1.jpg" class="img-fluid training-img fade-in-element" alt="…">
                        <p class="mt-3 mb-1 text-white fade-in-element" data-delay="0.1s"><b>Sharpen Your Skills</b></p>
                        <p class="text-white fade-in-element" data-delay="0.2s">Our training focuses on mastering
                            techniques through
                            targeted drills. From
                            smashes to footwork, every session builds consistency and control.</p>
                    </div>
                    <div class="col pb-4 fade-in-element">
                        <img src="Resources/bmt2.jpg" class="img-fluid training-img fade-in-element" alt="…"
                            data-delay="0.1s">
                        <p class="mt-3 mb-1 text-white fade-in-element" data-delay="0.2s"><b>Stronger Body & Mind</b>
                        </p>
                        <p class="text-white fade-in-element" data-delay="0.3s">Improve agility, endurance, and focus
                            with fitness and
                            mindset training.
                            Build confidence and resilience on and off the court.</p>
                    </div>
                    <div class="col pb-4 fade-in-element">
                        <img src="Resources/bmt3.webp" class="img-fluid training-img fade-in-element" alt="…"
                            data-delay="0.2s">
                        <p class="mt-3 mb-1 text-white fade-in-element" data-delay="0.3s"><b>Smarter Gameplay</b></p>
                        <p class="text-white fade-in-element" data-delay="0.4s">We use game-like scenarios to improve
                            decision-making.
                            Learn when to
                            attack, defend, and outsmart your opponent in real-time rallies.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="container py-5 text-center">
            <h2 class="title text-center mb-4 fade-in-element-u" style="color: #0A4B65;">UPCOMING EVENTS</h2>
            <div id="events-container" class="row justify-content-center fade-in-element-u">
            </div>
            <a href="events.html" class="btn btn-primary fade-in-element-u">ALL EVENTS</a>
        </div>

    </main>
    <div id="footer-placeholder" style="flex:0 0 auto;"></div>

    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <script src="js/script.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const eventsContainer = document.getElementById('events-container');
            if (!eventsContainer) return;

            let events = [];

            try {
                const cachedItem = localStorage.getItem('cachedEvents');
                if (cachedItem) {
                    const parsedCache = JSON.parse(cachedItem);
                    if (parsedCache && parsedCache.data) {
                        events = parsedCache.data;
                    }
                }
            } catch (error) {
                console.error("Failed to parse cached events:", error);
            }

            if (events.length === 0) {
                try {
                    events = await fetchAndCacheEvents();
                } catch (error) {
                    console.error('Failed to load upcoming events:', error);
                    eventsContainer.innerHTML = '<p class="text-center text-danger w-100">Could not load events. Please try refreshing the page.</p>';
                    return;
                }
            }

            const upcomingEvents = events.slice(0, 3);

            if (upcomingEvents.length > 0) {
                let cardsHtml = '';
                upcomingEvents.forEach(evt => {
                    cardsHtml += `
                        <div class="col-lg-4 col-md-6 mb-4 fade-in-element">
                            <div class="card h-100 shadow-sm">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title" style="color: #0A4B65;">${evt.title}</h5>
                                    <p class="card-text flex-grow-1">${evt.description}</p>
                                    <p class="card-text mb-1">
                                        <small class="text-muted">
                                            <i class="bi bi-geo-alt-fill me-2"></i>${evt.location}
                                        </small>
                                    </p>
                                    <p class="card-text">
                                        <small class="text-muted">
                                            <i class="bi bi-calendar-event-fill me-2"></i>
                                            ${new Date(evt.startTime.seconds * 1000).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' })}
                                        </small>
                                    </p>
                                </div>
                            </div>
                        </div>
                    `;
                });
                eventsContainer.innerHTML = cardsHtml;
            } else {
                eventsContainer.innerHTML = '<p class="text-center w-100">No upcoming events found. Please check back later!</p>';
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('#events-container .fade-in-element').forEach(el => {
                observer.observe(el);
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>